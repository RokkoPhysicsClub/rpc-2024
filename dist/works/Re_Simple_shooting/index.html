<!DOCTYPE html><head prefix="og: https://ogp.me/ns#"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"><meta lang="ja"><meta property="og:url" content="https://rokkophysicsclub.github.io/rpc-2024/works/Re_Simple_shooting/"><meta property="og:type" content="website"><meta property="og:title" content="Re:Simple_shooting"><meta property="og:image" content="https://rokkophysicsclub.github.io/rpc-2024/img/Re_Simple_shooting/Re_Simple_shooting.avif"><meta property="og:site_name" content="六甲学院物理部2024"><meta property="og:description" content="シンプルなシューティングゲームのリメイク版"><meta property="og:locale" content="https://rokkophysicsclub.github.io/rpc-2024/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@RokkoPhysics"><title>六甲学院物理部2024</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&display=swap" rel="stylesheet"><link rel="icon" href="../../favicon.svg" sizes="any" type="image/svg+xml"><link rel="stylesheet" href="../../_astro/about.DDtlOBCY.css">
<style>.card[data-astro-cid-dohjnao5]{width:90%;height:122px;display:flex;justify-content:end;text-decoration:none;background-color:#fff;color:#333;border-radius:10px;border-color:#3333;border-style:solid;border-width:1px;margin-block:1rem}.card-text[data-astro-cid-dohjnao5]{flex-grow:1;width:50%;display:flex;flex-direction:column;justify-content:center;padding:.8rem 1.2rem}.card-title[data-astro-cid-dohjnao5]{margin:0;display:-webkit-box;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1}.card-desc[data-astro-cid-dohjnao5]{margin:.2rem 0rem;color:#777;flex-grow:1;font-size:.85rem;display:-webkit-box;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2}.card-origin[data-astro-cid-dohjnao5]{margin:0;font-size:.85rem}.card-img[data-astro-cid-dohjnao5]{width:auto;border-radius:0 10px 10px 0;object-fit:cover}@media (max-width: 950px){.card-img[data-astro-cid-dohjnao5]{width:max(40%,122px)}}
</style><script type="module" src="../../_astro/hoisted.DA_UdhYa.js"></script></head> <body data-astro-cid-k74dcqyt> <div id="main-wrapper" data-astro-cid-k74dcqyt> <div id="sidebar-wrapper" data-astro-cid-k74dcqyt> <div id="title-container" data-astro-cid-ssfzsv2f> <h1 id="title" data-astro-cid-ssfzsv2f><a href="../../" data-astro-cid-ssfzsv2f>六甲学院物理部2024</a></h1> <p id="title-desc" data-astro-cid-ssfzsv2f>六甲学院物理部の2024年度オンライン文化祭サイトです。（学校非公式）</p> <ul class="menu" data-astro-cid-ssfzsv2f> <li data-astro-cid-ssfzsv2f><a href="../../" style="" data-astro-cid-ssfzsv2f>Welcome</a></li><li data-astro-cid-ssfzsv2f><a href="../../works/index.html" style="" data-astro-cid-ssfzsv2f>Works</a></li><li data-astro-cid-ssfzsv2f><a href="../../links/index.html" style="" data-astro-cid-ssfzsv2f>Links</a></li><li data-astro-cid-ssfzsv2f><a href="../../about/index.html" style="" data-astro-cid-ssfzsv2f>About</a></li> </ul> <div id="social" data-astro-cid-ssfzsv2f> <a class="sns-icon" href="https://x.com/RokkoPhysics" data-astro-cid-ssfzsv2f><img src="../../img/x-twitter.svg" alt="icon" data-astro-cid-ssfzsv2f></a><a class="sns-icon" href="https://github.com/RokkoPhysicsClub" data-astro-cid-ssfzsv2f><img src="../../img/github.svg" alt="icon" data-astro-cid-ssfzsv2f></a><a class="sns-icon" href="https://www.youtube.com/channel/UCvLDGaFKdbpQ7vELdrUSyCw" data-astro-cid-ssfzsv2f><img src="../../img/youtube.svg" alt="icon" data-astro-cid-ssfzsv2f></a><a class="sns-icon" href="https://sp.nicovideo.jp/user/88466335" data-astro-cid-ssfzsv2f><img src="../../img/niconico.svg" alt="icon" data-astro-cid-ssfzsv2f></a> </div> <p id="credit" data-astro-cid-ssfzsv2f>©2024 六甲学院物理部</p> </div>  </div> <div id="content-wrapper" data-astro-cid-k74dcqyt> <button id="menu-button" onclick="document.getElementById('sidebar-wrapper').classList.toggle('active');this.classList.toggle('active')" data-astro-cid-k74dcqyt> <img src="../../img/bars.svg" alt="bar" data-astro-cid-k74dcqyt>
Menu
</button>  <div id="container" data-astro-cid-qo5xhe7c> <h1 class="title" id="re:simple_shooting" data-astro-cid-qo5xhe7c>Re:Simple_shooting</h1> <p class="author" data-astro-cid-qo5xhe7c>by 83rd 0x4C</p> <div id="slot" data-astro-cid-qo5xhe7c> <p>人生で初めて製作したゲームをリメイクしました。</p>
<p>↓Re:Simple_shootingのリンク</p>
<a href="https://asynchronous-0x4c.github.io/Re_Simple_shooting/" class="card" data-astro-cid-dohjnao5> <div class="card-text" data-astro-cid-dohjnao5> <h3 class="card-title" data-astro-cid-dohjnao5>https://asynchronous-0x4c.github.io/Re_Simple_shooting/</h3>  <p class="card-origin" data-astro-cid-dohjnao5>asynchronous-0x4c.github.io</p> </div>  </a> 
<p>↓Simple_shootingのリンク</p>
<a href="https://asynchronous-0x4c.github.io/Simple_shooting_on_web/" class="card" data-astro-cid-dohjnao5> <div class="card-text" data-astro-cid-dohjnao5> <h3 class="card-title" data-astro-cid-dohjnao5>https://asynchronous-0x4c.github.io/Simple_shooting_on_web/</h3>  <p class="card-origin" data-astro-cid-dohjnao5>asynchronous-0x4c.github.io</p> </div>  </a> 
<h2 id="概要">概要</h2>
<ul>
<li>ソースコード: 綺麗</li>
<li>開発人数: 1人</li>
<li>開発期間: 2か月程度</li>
</ul>
<p><img src="../../img/Re_Simple_shooting/Re_Simple_shooting.avif" alt="Re:Simple_shooting"/></p>
<h2 id="遊び方">遊び方</h2>
<p>主に上から流れてくる敵を倒すだけです。</p>
<p>一応クリア条件が存在するものの、現時点ではそれほど重要ではないです。</p>
<h2 id="実装に関して">実装に関して</h2>
<p>このゲームの実装にあたって、様々な工夫を行いました。</p>
<h3 id="webとネイティブの同時開発">Webとネイティブの同時開発</h3>
<p>今回は、開発初期からWebでもプレイできるように工夫しました。</p>
<p>具体的には、</p>
<ol>
<li>Processingで開発</li>
<li>ProcessingのソースコードをProcessing.jsを用いてJavaScriptから実行</li>
</ol>
<p>という流れで制作することにより、随時デバッグをしながらWebとネイティブの両方に対応したソースコードを書きました。</p>
<p>ちなみに、この手法で開発をすると様々な制約が付き、例えば</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">ArrayList</span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8">String</span><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8">list;</span><span style="color:#6A737D">//これはエラー</span></span>
<span class="line"><span style="color:#E1E4E8">ArrayList&lt;</span><span style="color:#F97583">String</span><span style="color:#E1E4E8">&gt; list;</span><span style="color:#6A737D">//これはOK</span></span>
<span class="line"></span></code></pre>
<p>というような、結構理不尽なエラーに見舞われたりします。</p>
<p>そんなに苦労するぐらいならHaxeを使え?<br/>
ﾁｮｯﾄﾅﾆｲｯﾃﾙｶﾜｶﾗﾅｲｯｽﾈ。</p>
<h3 id="webアプリケーション化">Webアプリケーション化</h3>
<p>今回はWebアプリケーション(PWA)に挑戦してみました。</p>
<p>Webアプリケーションというのは、普通のアプリケーションがOS上で動いているのに対し、Webブラウザ上でアプリケーションを動かすことで様々なOSに対応したアプリケーションにしようというものです。<br/>
つまるところ、一度プログラムが完成すればPCでもスマホでも学校のiPadでも動きます。</p>
<p>それに加えて、PWAはたとえインターネットにつながっていない状態でも、一度でもアクセスしたことがあるのであれば動きます。<br/>
なので、学校のiPadに入れればインターネットに接続できない帰り道や電車の中でも遊べます。<br/>
ちなみに、オフライン対応をした動機は、シンガポール・マレーシア研修で飛行機に乗る際にゲームで遊びたかったからです。</p>
<p>具体的な実装は以下のようになります。(オフラインについては次節で説明)<br/>
まず、webページの<code>&lt;head&gt;</code>内に以下の内容を記述</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="html"><code><span class="line"><span style="color:#E1E4E8">&lt;</span><span style="color:#85E89D">link</span><span style="color:#B392F0"> rel</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;manifest&quot;</span><span style="color:#B392F0"> href</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;./manifest.json&quot;</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">&lt;</span><span style="color:#85E89D">meta</span><span style="color:#B392F0"> name</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;mobile-web-app-capable&quot;</span><span style="color:#B392F0"> content</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;yes&quot;</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"></span></code></pre>
<p><code>manifest.json</code>を以下のように記述</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="json"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;$schema&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;https://json.schemastore.org/web-manifest-combined.json&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;name&quot;</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">&quot;サイト名&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;short_name&quot;</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">&quot;サイト名(省略)&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;background_color&quot;</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">&quot;背景色&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;theme_color&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;モバイル端末の上側のバーの色&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;icons&quot;</span><span style="color:#E1E4E8">:[</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#79B8FF">      &quot;src&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;./favicon.png&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">      &quot;sizes&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;512x512&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">      &quot;type&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;image/png&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">      &quot;purpose&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;any&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#79B8FF">      &quot;src&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;./favicon.png&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">      &quot;sizes&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;512x512&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">      &quot;type&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;image/png&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">      &quot;purpose&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;maskable&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  ],</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;start_url&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;index.hmtlの場所&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;scope&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;Webサイトの場所&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;display&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;standalone&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>こうすることで、Webサイトをホーム画面に追加する際、インストールができるようになります。</p>
<h3 id="オフライン対応">オフライン対応</h3>
<p>PWAにおいて、ゲームのオフライン対応は結構難しかったりします。<br/>
というのも、オフライン対応のために利用する<code>Cache API</code>というものがなかなかの曲者で、<code>XMLHttpRequest</code>をキャッシュする条件が分からなかったり、キャッシュするファイルを指定する際に迂闊に<code>cache.addAll()</code>を使おうものなら大量のファイルのパスを全て間違いなく記載する羽目になったりするからです。</p>
<p>まあとりあえず実装を見ていきましょう。<br/>
まず、<code>index.html</code>に以下のスクリプトを追加します</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">if</span><span style="color:#E1E4E8"> (</span><span style="color:#9ECBFF">&#39;serviceWorker&#39;</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> navigator) {</span></span>
<span class="line"><span style="color:#E1E4E8">  navigator.serviceWorker.</span><span style="color:#B392F0">register</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#39;sw.js&#39;</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">function</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">registration</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#39;Service Worker registered with scope:&#39;</span><span style="color:#E1E4E8">, registration.scope);</span></span>
<span class="line"><span style="color:#E1E4E8">    registration.</span><span style="color:#B392F0">update</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">  }).</span><span style="color:#B392F0">catch</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">function</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">error</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#39;Service Worker registration failed:&#39;</span><span style="color:#E1E4E8">, error);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>これにより、<code>Cache API</code>を利用するための<code>Service Worker</code>を登録します。<br/>
<code>Service Worker</code>側のソースコードは以下のようになります。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> CACHE_VERSION</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;rssc-v1&#39;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> DISP_VERSION</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;rssc-d-v1&#39;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> resources</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[</span></span>
<span class="line"><span style="color:#9ECBFF">  &quot;キャッシュしたいファイルへの相対パスたち&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">self.</span><span style="color:#B392F0">addEventListener</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#39;install&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">event</span><span style="color:#F97583"> =&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  event.</span><span style="color:#B392F0">waitUntil</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#6A737D">    //Service Workerがインストールされたら、キャッシュしたいファイルを登録する。</span></span>
<span class="line"><span style="color:#6A737D">    //addAll()は1つでも存在しないファイルが指定されている場合に使えないので、add()で代用するのがおすすめ。</span></span>
<span class="line"><span style="color:#E1E4E8">    caches.</span><span style="color:#B392F0">open</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">CACHE_VERSION</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">cache</span><span style="color:#F97583"> =&gt;</span><span style="color:#E1E4E8"> resources.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">r</span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8">cache.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(r)))</span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#E1E4E8">  event.</span><span style="color:#B392F0">waitUntil</span><span style="color:#E1E4E8">(self.</span><span style="color:#B392F0">skipWaiting</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">self.</span><span style="color:#B392F0">addEventListener</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#39;fetch&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">event</span><span style="color:#F97583"> =&gt;</span><span style="color:#E1E4E8"> {</span><span style="color:#6A737D">//fetch()を使うと呼び出される。XMLHttpRequestは呼び出されたり呼び出されなかったり。</span></span>
<span class="line"><span style="color:#E1E4E8">  event.</span><span style="color:#B392F0">respondWith</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">    caches.</span><span style="color:#B392F0">match</span><span style="color:#E1E4E8">(event.request)</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">response</span><span style="color:#F97583"> =&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> response </span><span style="color:#F97583">||</span><span style="color:#B392F0"> fetch</span><span style="color:#E1E4E8">(event.request)</span><span style="color:#6A737D">//キャッシュがある場合はキャッシュを使用、ない場合はfetch()で取ってくる</span></span>
<span class="line"><span style="color:#E1E4E8">          .</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">networkResponse</span><span style="color:#F97583"> =&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> caches.</span><span style="color:#B392F0">open</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">CACHE_VERSION</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">              .</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">cache</span><span style="color:#F97583"> =&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8">(event.request.url.</span><span style="color:#B392F0">includes</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#39;http&#39;</span><span style="color:#E1E4E8">))cache.</span><span style="color:#B392F0">put</span><span style="color:#E1E4E8">(event.request, networkResponse.</span><span style="color:#B392F0">clone</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#F97583">                return</span><span style="color:#E1E4E8"> networkResponse;</span><span style="color:#6A737D">//fetch()で取ってきたデータをキャッシュ</span></span>
<span class="line"><span style="color:#E1E4E8">              });</span></span>
<span class="line"><span style="color:#E1E4E8">          });</span></span>
<span class="line"><span style="color:#E1E4E8">      })</span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">self.</span><span style="color:#B392F0">addEventListener</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#39;activate&#39;</span><span style="color:#E1E4E8">,(</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8">{</span><span style="color:#6A737D">//起動時にキャッシュを更新する。</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> cacheWhitelist</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">CACHE_VERSION</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#E1E4E8">  e.</span><span style="color:#B392F0">waitUntil</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">    caches.</span><span style="color:#B392F0">keys</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">cacheNames</span><span style="color:#F97583"> =&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      return</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">all</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">        cacheNames.</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">cacheName</span><span style="color:#F97583"> =&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">          if</span><span style="color:#E1E4E8"> (cacheWhitelist.</span><span style="color:#B392F0">indexOf</span><span style="color:#E1E4E8">(cacheName) </span><span style="color:#F97583">===</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> caches.</span><span style="color:#B392F0">delete</span><span style="color:#E1E4E8">(cacheName);</span></span>
<span class="line"><span style="color:#E1E4E8">          }</span></span>
<span class="line"><span style="color:#E1E4E8">        })</span></span>
<span class="line"><span style="color:#E1E4E8">      );</span></span>
<span class="line"><span style="color:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span></code></pre>
<p>ここまでを実装することで、<strong>通常のサイトであれば</strong>晴れてオフラインに対応することができます。</p>
<h3 id="xmlhttprequestとの闘い">XMLHttpRequestとの闘い</h3>
<p>Processing.jsはXMLHttpRequestを使います。</p>
<p>え?よく聞こえなかった?<br/>
ならもう一度言います。</p>
<p><strong>Processing.jsはXMLHttpRequestを使います。</strong><br/>
<strong>そして、XMLHttpRequestを使うということは、ゲームで使うデータをキャッシュできないということを意味します。</strong></p>
<p>つまり、<strong>最大の敵は他でもないProcessing.js</strong>ということです。<br/>
現状、ProcessingのスケッチをJavaScriptに変換できるのはProcessing.jsのみなので、この問題を避けて通ることはできません。</p>
<h3 id="xmlhttprequestとの闘い解決編">XMLHttpRequestとの闘い(解決編)</h3>
<p>いくら避けようがないとは言え、解決策はあります。</p>
<p>具体的には、</p>
<ol>
<li>Processingでのみ読み込む.pdeファイルを作成</li>
<li>作成したファイル内にファイル読み込み関数を作成</li>
<li>Webで読み込むJavaScriptファイルを作成</li>
<li>JavaScript側にも同じ名前のファイル読み込み関数を作成。このとき、<code>fetch()</code>を使う。
というようにするとXMLHttpRequestからfetchに移行することができます。</li>
</ol>
<p>ソースコードは下記のリンクの<code>JSONManager</code>や<code>loadJSONObjectAsync()</code>を参照すれば分かります。</p>
<a href="https://github.com/Asynchronous-0x4C/Re_Simple_shooting/blob/20a7b8b9979d332c7c40d64bbbd6d2398f5ef549/Wrapper.pde#L176" class="card" data-astro-cid-dohjnao5> <div class="card-text" data-astro-cid-dohjnao5> <h3 class="card-title" data-astro-cid-dohjnao5>Re_Simple_shooting/Wrapper.pde at 20a7b8b9979d332c7c40d64bbbd6d2398f5ef549 · Asynchronous-0x4C/Re_Simple_shooting</h3> <p class="card-desc" data-astro-cid-dohjnao5>Contribute to Asynchronous-0x4C/Re_Simple_shooting development by creating an account on GitHub.</p> <p class="card-origin" data-astro-cid-dohjnao5>github.com</p> </div> <img class="card-img" src="https://opengraph.githubassets.com/f66be7371ea39c9039932e537e4edcaccb8f9b26de89a95b07187f934cc675d5/Asynchronous-0x4C/Re_Simple_shooting" alt="image" data-astro-cid-dohjnao5> </a> 
<a href="https://github.com/Asynchronous-0x4C/Re_Simple_shooting/blob/20a7b8b9979d332c7c40d64bbbd6d2398f5ef549/js/wrapper.js#L23" class="card" data-astro-cid-dohjnao5> <div class="card-text" data-astro-cid-dohjnao5> <h3 class="card-title" data-astro-cid-dohjnao5>Re_Simple_shooting/js/wrapper.js at 20a7b8b9979d332c7c40d64bbbd6d2398f5ef549 · Asynchronous-0x4C/Re_Simple_shooting</h3> <p class="card-desc" data-astro-cid-dohjnao5>Contribute to Asynchronous-0x4C/Re_Simple_shooting development by creating an account on GitHub.</p> <p class="card-origin" data-astro-cid-dohjnao5>github.com</p> </div> <img class="card-img" src="https://opengraph.githubassets.com/f66be7371ea39c9039932e537e4edcaccb8f9b26de89a95b07187f934cc675d5/Asynchronous-0x4C/Re_Simple_shooting" alt="image" data-astro-cid-dohjnao5> </a> 
<h2 id="さいごに">さいごに</h2>
<p>PWAについて書こうと思ったらなかなかな長文になってしまいました。<br/>
もはやここまで読む人は誰も居ないと思いますが、ゲームを遊んでいただけると幸いです。</p>
<p>では。</p> </div> </div> <div id="heading-list" data-astro-cid-qo5xhe7c> <div id="heading-container" data-astro-cid-qo5xhe7c> <div class="heading-box" data-astro-cid-qo5xhe7c> <h2 id="author-box" data-astro-cid-qo5xhe7c>83rd 0x4C</h2> </div> <div class="heading-box" id="box-sticky" data-astro-cid-qo5xhe7c> <ol class="ol-depth-1" data-astro-cid-qo5xhe7c> <li data-astro-cid-qo5xhe7c> <a href="#re:simple_shooting" id="anchor-re:simple_shooting" data-astro-cid-qo5xhe7c> Re:Simple_shooting </a>  </li><li data-astro-cid-qo5xhe7c> <a href="#概要" id="anchor-概要" data-astro-cid-qo5xhe7c> 概要 </a>  </li><li data-astro-cid-qo5xhe7c> <a href="#遊び方" id="anchor-遊び方" data-astro-cid-qo5xhe7c> 遊び方 </a>  </li><li data-astro-cid-qo5xhe7c> <a href="#実装に関して" id="anchor-実装に関して" data-astro-cid-qo5xhe7c> 実装に関して </a> <ol class="ol-depth-2" data-astro-cid-qo5xhe7c><li data-astro-cid-qo5xhe7c> <a href="#webとネイティブの同時開発" id="anchor-webとネイティブの同時開発" data-astro-cid-qo5xhe7c>Webとネイティブの同時開発</a> </li><li data-astro-cid-qo5xhe7c> <a href="#webアプリケーション化" id="anchor-webアプリケーション化" data-astro-cid-qo5xhe7c>Webアプリケーション化</a> </li><li data-astro-cid-qo5xhe7c> <a href="#オフライン対応" id="anchor-オフライン対応" data-astro-cid-qo5xhe7c>オフライン対応</a> </li><li data-astro-cid-qo5xhe7c> <a href="#xmlhttprequestとの闘い" id="anchor-xmlhttprequestとの闘い" data-astro-cid-qo5xhe7c>XMLHttpRequestとの闘い</a> </li><li data-astro-cid-qo5xhe7c> <a href="#xmlhttprequestとの闘い解決編" id="anchor-xmlhttprequestとの闘い解決編" data-astro-cid-qo5xhe7c>XMLHttpRequestとの闘い(解決編)</a> </li></ol> </li><li data-astro-cid-qo5xhe7c> <a href="#さいごに" id="anchor-さいごに" data-astro-cid-qo5xhe7c> さいごに </a>  </li> </ol> </div> </div> </div> </div> </div> </body>   